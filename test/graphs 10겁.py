from pymongo import MongoClient
from datetime import datetime

# 1) MongoDB 연결 설정
client = MongoClient("mongodb+srv://coque:hoo8176@clusterloa.tdpglbb.mongodb.net/?retryWrites=true&w=majority")
db = client["lostark"]
collection = db["jewelry_value"]

# 2) 이미 파싱해 둔 JSON 데이터 예시
raw = {
    "success": True,
    "itemData": [
        {
            "date": "2025-03-29",
            "name": "10레벨 겁화의 보석",
            "price": 2850000
        },
        {
            "date": "2025-03-30",
            "name": "10레벨 겁화의 보석",
            "price": 2850000
        },
        {
            "date": "2025-03-31",
            "name": "10레벨 겁화의 보석",
            "price": 2939000
        },
        {
            "date": "2025-04-01",
            "name": "10레벨 겁화의 보석",
            "price": 2900000
        },
        {
            "date": "2025-04-02",
            "name": "10레벨 겁화의 보석",
            "price": 2915000
        },
        {
            "date": "2025-04-03",
            "name": "10레벨 겁화의 보석",
            "price": 2840000
        },
        {
            "date": "2025-04-04",
            "name": "10레벨 겁화의 보석",
            "price": 2820000
        },
        {
            "date": "2025-04-05",
            "name": "10레벨 겁화의 보석",
            "price": 2870000
        },
        {
            "date": "2025-04-06",
            "name": "10레벨 겁화의 보석",
            "price": 2820000
        },
        {
            "date": "2025-04-07",
            "name": "10레벨 겁화의 보석",
            "price": 2787000
        },
        {
            "date": "2025-04-08",
            "name": "10레벨 겁화의 보석",
            "price": 2700000
        },
        {
            "date": "2025-04-09",
            "name": "10레벨 겁화의 보석",
            "price": 2736000
        },
        {
            "date": "2025-04-10",
            "name": "10레벨 겁화의 보석",
            "price": 2720000
        },
        {
            "date": "2025-04-11",
            "name": "10레벨 겁화의 보석",
            "price": 2734000
        },
        {
            "date": "2025-04-12",
            "name": "10레벨 겁화의 보석",
            "price": 2740000
        },
        {
            "date": "2025-04-13",
            "name": "10레벨 겁화의 보석",
            "price": 2739900
        },
        {
            "date": "2025-04-14",
            "name": "10레벨 겁화의 보석",
            "price": 2659000
        },
        {
            "date": "2025-04-15",
            "name": "10레벨 겁화의 보석",
            "price": 2529999
        },
        {
            "date": "2025-04-16",
            "name": "10레벨 겁화의 보석",
            "price": 2600000
        },
        {
            "date": "2025-04-17",
            "name": "10레벨 겁화의 보석",
            "price": 2610000
        },
        {
            "date": "2025-04-18",
            "name": "10레벨 겁화의 보석",
            "price": 2644999
        },
        {
            "date": "2025-04-19",
            "name": "10레벨 겁화의 보석",
            "price": 2650000
        },
        {
            "date": "2025-04-20",
            "name": "10레벨 겁화의 보석",
            "price": 2670000
        },
        {
            "date": "2025-04-21",
            "name": "10레벨 겁화의 보석",
            "price": 2689999
        },
        {
            "date": "2025-04-22",
            "name": "10레벨 겁화의 보석",
            "price": 2866444
        },
        {
            "date": "2025-04-23",
            "name": "10레벨 겁화의 보석",
            "price": 2834444
        },
        {
            "date": "2025-04-24",
            "name": "10레벨 겁화의 보석",
            "price": 2810000
        },
        {
            "date": "2025-04-25",
            "name": "10레벨 겁화의 보석",
            "price": 2949999
        },
        {
            "date": "2025-04-26",
            "name": "10레벨 겁화의 보석",
            "price": 2970000
        },
        {
            "date": "2025-04-27",
            "name": "10레벨 겁화의 보석",
            "price": 2958000
        },
        {
            "date": "2025-04-28",
            "name": "10레벨 겁화의 보석",
            "price": 2900000
        },
        {
            "date": "2025-04-29",
            "name": "10레벨 겁화의 보석",
            "price": 2894000
        },
        {
            "date": "2025-04-30",
            "name": "10레벨 겁화의 보석",
            "price": 2750000
        },
        {
            "date": "2025-05-01",
            "name": "10레벨 겁화의 보석",
            "price": 2220000
        },
        {
            "date": "2025-05-02",
            "name": "10레벨 겁화의 보석",
            "price": 2310000
        },
        {
            "date": "2025-05-03",
            "name": "10레벨 겁화의 보석",
            "price": 2260000
        },
        {
            "date": "2025-05-04",
            "name": "10레벨 겁화의 보석",
            "price": 2275000
        },
        {
            "date": "2025-05-05",
            "name": "10레벨 겁화의 보석",
            "price": 2240000
        },
        {
            "date": "2025-05-06",
            "name": "10레벨 겁화의 보석",
            "price": 2219000
        },
        {
            "date": "2025-05-07",
            "name": "10레벨 겁화의 보석",
            "price": 2150000
        },
        {
            "date": "2025-05-08",
            "name": "10레벨 겁화의 보석",
            "price": 2249900
        },
        {
            "date": "2025-05-09",
            "name": "10레벨 겁화의 보석",
            "price": 2378888
        },
        {
            "date": "2025-05-10",
            "name": "10레벨 겁화의 보석",
            "price": 2360000
        },
        {
            "date": "2025-05-11",
            "name": "10레벨 겁화의 보석",
            "price": 2429999
        },
        {
            "date": "2025-05-12",
            "name": "10레벨 겁화의 보석",
            "price": 2450000
        },
        {
            "date": "2025-05-13",
            "name": "10레벨 겁화의 보석",
            "price": 2379000
        },
        {
            "date": "2025-05-14",
            "name": "10레벨 겁화의 보석",
            "price": 2343900
        },
        {
            "date": "2025-05-15",
            "name": "10레벨 겁화의 보석",
            "price": 2300000
        },
        {
            "date": "2025-05-16",
            "name": "10레벨 겁화의 보석",
            "price": 2260000
        },
        {
            "date": "2025-05-17",
            "name": "10레벨 겁화의 보석",
            "price": 2248000
        },
        {
            "date": "2025-05-18",
            "name": "10레벨 겁화의 보석",
            "price": 2389000
        },
        {
            "date": "2025-05-19",
            "name": "10레벨 겁화의 보석",
            "price": 2299999
        },
        {
            "date": "2025-05-20",
            "name": "10레벨 겁화의 보석",
            "price": 2269990
        },
        {
            "date": "2025-05-21",
            "name": "10레벨 겁화의 보석",
            "price": 2239400
        },
        {
            "date": "2025-05-22",
            "name": "10레벨 겁화의 보석",
            "price": 2190000
        },
        {
            "date": "2025-05-23",
            "name": "10레벨 겁화의 보석",
            "price": 2100000
        },
        {
            "date": "2025-05-24",
            "name": "10레벨 겁화의 보석",
            "price": 2155555
        },
        {
            "date": "2025-05-25",
            "name": "10레벨 겁화의 보석",
            "price": 2040000
        },
        {
            "date": "2025-05-26",
            "name": "10레벨 겁화의 보석",
            "price": 2040000
        },
        {
            "date": "2025-05-27",
            "name": "10레벨 겁화의 보석",
            "price": 1959000
        },
        {
            "date": "2025-05-28",
            "name": "10레벨 겁화의 보석",
            "price": 1940000
        },
        {
            "date": "2025-05-29",
            "name": "10레벨 겁화의 보석",
            "price": 1829999
        },
        {
            "date": "2025-05-30",
            "name": "10레벨 겁화의 보석",
            "price": 1779000
        },
        {
            "date": "2025-05-31",
            "name": "10레벨 겁화의 보석",
            "price": 1904999
        },
        {
            "date": "2025-06-01",
            "name": "10레벨 겁화의 보석",
            "price": 1950000
        },
        {
            "date": "2025-06-02",
            "name": "10레벨 겁화의 보석",
            "price": 2100000
        },
        {
            "date": "2025-06-03",
            "name": "10레벨 겁화의 보석",
            "price": 1933000
        },
        {
            "date": "2025-06-04",
            "name": "10레벨 겁화의 보석",
            "price": 1888888
        },
        {
            "date": "2025-06-05",
            "name": "10레벨 겁화의 보석",
            "price": 1990000
        },
        {
            "date": "2025-06-06",
            "name": "10레벨 겁화의 보석",
            "price": 1998997
        },
        {
            "date": "2025-06-07",
            "name": "10레벨 겁화의 보석",
            "price": 2040000
        },
        {
            "date": "2025-06-08",
            "name": "10레벨 겁화의 보석",
            "price": 2030000
        },
        {
            "date": "2025-06-09",
            "name": "10레벨 겁화의 보석",
            "price": 2079000
        },
        {
            "date": "2025-06-10",
            "name": "10레벨 겁화의 보석",
            "price": 2150000
        },
        {
            "date": "2025-06-10",
            "name": "10레벨 겁화의 보석",
            "price": 2168888
        }
    ]
}

# 3) 문서 리스트 생성
ITEM_CODE = 65031100
IMAGE_URL = "https://cdn-lostark.game.onstove.com/efui_iconatlas/use/use_12_105.png"

docs = []
for item in raw["itemData"]:
    # 날짜 문자열을 datetime 객체로 변환(선택)
    date_obj = datetime.strptime(item["date"], "%Y-%m-%d")
    
    doc = {
        "date":       date_obj,         # 또는 그냥 item["date"] (문자열) 그대로 사용
        "name":       item["name"],
        "price":      item["price"],
        "item_code":  ITEM_CODE,
        "image_url":  IMAGE_URL
    }
    docs.append(doc)

for doc in docs:
    collection.update_one(
        {"item_code": doc["item_code"], "date": doc["date"]},
        {"$set": doc},
        upsert=True
    )